# Base image

based_on scratch

### cleanroom will have added the following substitution patterns:
###  # TIMESTAMP:   timestamp of installation
###  # SYSTEM:      system name
###  # BASE_SYSTEM: system name of the base
###  # ROOT:        path to the systems filesystem root

# Set up some more substitutions:
set ARCH x86_64
set VENDOR org.archlinux.cleanroom
set KERNEL_CMDLINE ''

# sed is needed for locale-gen
pacstrap config=type-base/pacstrap.conf
    glibc gzip

    pacman

    sed shadow systemd

net_firewall_configure

append /usr/lib/os-release <<<<
VERSION=${TIMESTAMP}
VERSION_ID=${TIMESTAMP}
>>>>

create /etc/machine.info <<<<PRETTY_HOSTNAME="Some machine"
ICON_NAME="computer"
CHASSIS="server"
>>>>

setup_readonly_usr

set_timezone Europe/Berlin
set_default_target multi-user.target
set_locales de_DE en_US

## root password is 'root'
usermod root password='$$6$$7YexNe71gbljWuon$$WkE6mSHd01osomCEMj/6rSX839atK7GTklCmUqy8poME22Oo1GKvDG3VUufdiKcwmR4Eo/A9W92NK8HhVmtxo1'

sed 's/^[ \\t#]*KillUserProcesses=.*$$/KillUserProcesses=yes/' /etc/systemd/logind.conf
